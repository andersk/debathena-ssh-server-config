# Warn the user if they log in without tickets or tokens

# Check to make sure the user does not have a local account
set is_nonlocal=`env NSS_NONLOCAL_IGNORE=1 getent passwd $USER`
if ("$is_nonlocal" == "") then
    set tickets=""
    set tokens=""

    # Check for tickets
    klist -s
    if ("$?" == 0) then
        set tickets="yes"
    endif

    # Check for tokens
    tokens | grep -q 'athena\.mit\.edu'
    if ("$?" == 0) then
        set tokens="yes"
    endif

    if ("$tokens" != "yes" && "$tickets" != "yes") then
        echo "WARNING: You have no valid Kerberos tickets and no valid AFS tokens."
        echo "See http://debathena.mit.edu/ssh"
    else if ("$tokens" != "yes") then
        echo "WARNING: You have no valid AFS tokens."
        echo "See http://debathena.mit.edu/ssh"
    else if ("$tickets" != "yes") then
        echo "WARNING: You have no valid Kerberos tickets."
        echo "See http://debathena.mit.edu/ssh"
    endif
endif
